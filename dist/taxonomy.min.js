!function(t){t.fn.justtext=function(){var t="";return this.contents().each(function(){3==this.nodeType&&(t+=this.textContent||this.innerText||"")}),t},t.fn.taxonomy_jquery=function(a){var e=t.extend({tagClass:".tag",tagClasses:"label label-default",tagActiveClass:".tag-active",tagCreateClass:".tag-create",tagUndo:".tag-undo",tagSlugData:"data-tag-slug",addInput:"#tag-cloud-input",hiddenFieldName:"taxonomy-new-tags[]",undoCharacter:"X",createButton:!0,createButtonPosition:"first",createButtonLabel:"+ Create a tag"},a);e.listClass=this,e.existingTags={},e.newTags={},e.activeTags={},e.init=function(){e.listClass.find("li").each(function(){var a=t(this).text();t(this).hasClass("tag-active")&&e.addTag(a,e.activeTags),t(this).addClass(e.tagClasses+" "+e.tagClass.substr(1)),t(this).attr(e.tagSlugData,e.toSlug(a)),e.addTag(a,e.existingTags)}),e.toggleInputField(!1),e.resetForm()},e.toSlug=function(t){return encodeURIComponent(t).toLowerCase()},e.addInputTag=function(){var a=this.cutInputVal(this.addInput).replace(/^,|,$/g,"");if(e.inObject(a,e.existingTags))e.toggleTagOn(t("li["+e.tagSlugData+'="'+e.toSlug(a)+'"]'));else if(this.addTag(a,e.newTags)===!0&&a){var s='<li class="label label-default '+e.tagClass.substr(1)+" "+e.tagActiveClass.substr(1)+'">'+a+'<a href="#" class="'+e.tagUndo.substr(1)+'" '+e.tagSlugData+'="'+e.toSlug(a)+'">'+e.undoCharacter+"</a></li>";t(s).prependTo(e.listClass),e.addTag(a,e.activeTags)}this.resetForm()},e.resetForm=function(){t('input[name="'+this.hiddenFieldName+'"]').remove();var a="";t.each(this.activeTags,function(t,s){a+='<input type="hidden" name="'+e.hiddenFieldName+'" value="'+s+'">'});var s=t(this.listClass).closest("form");t(a).appendTo(s)},e.undoNewTag=function(a){this.removeTag(a,e.newTags),this.removeTag(a,e.activeTags),t("a["+e.tagSlugData+"='"+e.toSlug(a)+"']").parent(".tag").remove(),this.resetForm()},e.removeTag=function(t,a){if(!e.inObject(t,a))return!1;var s=e.toSlug(t);delete a[s]},e.inObject=function(t,a){var s=e.toSlug(t);return s in a?!0:!1},e.addTag=function(t,a){var s=e.toSlug(t);return s in a?!1:(a[s]=t,!0)},e.cutInputVal=function(a){var e=t(a).val();return t(a).val(""),e},e.toggleTagActivation=function(t){var a=t.text();t.hasClass(e.tagActiveClass.substr(1))?(t.removeClass(e.tagActiveClass.substr(1)),e.removeTag(a,e.activeTags)):(t.addClass(e.tagActiveClass.substr(1)),e.addTag(a,e.activeTags)),e.resetForm()},e.toggleTagOn=function(t){var a=t.text();t.hasClass(e.tagActiveClass.substr(1))||t.addClass(e.tagActiveClass.substr(1)),e.addTag(a,e.activeTags)},e.toggleInputField=function(a){if(void 0===a&&(a=0===t(e.addInput).length?!0:!1),a===!0){var s='<div class="form-group"><input id="'+e.addInput.substr(1)+'" type="text" class="form-control" placeholder="Add tags separated by a comma..."></div>';t(s).insertBefore(t(e.listClass)),t(e.addInput).focus()}else e.createButton&&("last"==e.createButtonPosition?e.listClass.append('<li class="'+e.tagClasses+" "+e.tagCreateClass.substr(1)+'">'+e.createButtonLabel+"</li>"):e.listClass.prepend('<li class="'+e.tagClasses+" "+e.tagCreateClass.substr(1)+'">'+e.createButtonLabel+"</li>"))},t(e.listClass).on("click",e.tagCreateClass,function(){return e.toggleInputField(!0),t(this).remove(),!1}),t(e.listClass).on("click",e.tagClass,function(){return e.toggleTagActivation(t(this)),!1}),t(e.listClass).parent().on("keydown",e.addInput,function(a){return(188==a.keyCode||9==a.keyCode||13==a.keyCode)&&(a.preventDefault(),e.addInputTag()),8==a.keyCode&&0===t(e.addInput).val().length?(e.toggleInputField(!1),t(this).remove(),!1):void 0}),t(e.listClass).on("click",e.tagUndo,function(){var a=t(this).parent().justtext();e.undoNewTag(a)}),e.init()}}(jQuery);